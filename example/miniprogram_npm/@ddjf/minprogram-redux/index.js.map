{"version":3,"sources":["index.js","Provider.js","warning.js","store.js","connect.js","shallowEqual.js","wrapActionCreators.js","app.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AGTA,ADGA;ADIA,ADGA,AGTA,ADGA;ADIA,ADGA,AGTA,ADGA;ADIA,AGTA,AJYA,AGTA,ADGA;ADIA,AGTA,AJYA,AGTA,ADGA;ADIA,AGTA,AJYA,AGTA,ADGA;ADIA,AGTA,AJYA,AKfA,AFMA,ADGA;ADIA,AGTA,ACHA,AFMA,ADGA;ADIA,AGTA,ACHA,AFMA,ADGA;ADIA,AGTA,ACHA,AFMA,ADGA,AIZA;ALgBA,AGTA,ACHA,AFMA,ADGA,AIZA;ALgBA,AGTA,ACHA,AFMA,ADGA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AFMA,ADGA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AFMA,ADGA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AFMA,ADGA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ALgBA,AMlBA,AHSA,ACHA,AHSA,AIZA;ACFA,AHSA,ACHA,AHSA,AIZA;ACFA,AHSA,ACHA,AHSA,AIZA;ACFA,AHSA,ACHA,AHSA,AIZA;ACFA,AHSA,ACHA,ACHA;ACFA,AHSA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["/**\r\n * function: index\r\n * author  : wq\r\n * update  : 2019/5/23 15:41\r\n */\r\nvar __TEMP__ = require('./Provider.js');var Provider = __REQUIRE_DEFAULT__(__TEMP__);\r\nvar __TEMP__ = require('./connect.js');var connect = __REQUIRE_DEFAULT__(__TEMP__);\r\nvar __TEMP__ = require('./app.js');var setApp = __TEMP__['setApp'];var getApp = __TEMP__['getApp'];\r\n\r\nmodule.exports = {\r\n  Provider: Provider,\r\n  connect: connect,\r\n  setApp,\r\n  getApp\r\n}\r\n","/**\r\n * function: Provider\r\n * author  : wq\r\n * update  : 2019/5/23 15:41\r\n */\r\nvar __TEMP__ = require('./warning.js');var warning = __REQUIRE_DEFAULT__(__TEMP__);\r\nvar __TEMP__ = require('./store');var setStore = __TEMP__['setStore'];\r\n\r\nfunction checkStoreShape(store) {\r\n  const missingMethods = ['subscribe', 'dispatch', 'getState'].filter(m => !store.hasOwnProperty(m));\r\n\r\n  if (missingMethods.length > 0) {\r\n    warning(\r\n      'Store似乎不是一个合法的Redux Store对象: ' +\r\n      '缺少这些方法: ' + missingMethods.join(', ') + '。'\r\n    )\r\n  }\r\n}\r\n\r\nfunction Provider(store) {\r\n  checkStoreShape(store)\r\n  setStore(store)\r\n  return function (appConfig) {\r\n    return { ...appConfig, store }\r\n  }\r\n}\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = Provider;\r\n","/**\r\n * function: warning\r\n * author  : wq\r\n * update  : 2019/5/23 15:43\r\n */\r\n/**\r\n * Prints a warning in the console if it exists.\r\n *\r\n * @param {String} message The warning message.\r\n * @returns {void}\r\n */\r\nfunction warning(message) {\r\n  /* eslint-disable no-console */\r\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\r\n    console.error(message)\r\n  }\r\n  /* eslint-enable no-console */\r\n  try {\r\n    // This error was thrown as a convenience so that if you enable\r\n    // \"break on all exceptions\" in your console,\r\n    // it would pause the execution at this line.\r\n    throw new Error(message)\r\n    /* eslint-disable no-empty */\r\n  } catch (e) {}\r\n  /* eslint-enable no-empty */\r\n}\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = warning;\r\n","/**\r\n * function: store\r\n * author  : wq\r\n * update  : 2019/5/27 11:38\r\n */\r\nlet _store = null\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var setStore = exports.setStore = (store) => {\r\n  _store = store\r\n};\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var getStore = exports.getStore = () => {\r\n  return _store\r\n};\r\n","/**\r\n * function: connect\r\n * author  : wq\r\n * update  : 2019/5/23 10:36\r\n */\r\nvar __TEMP__ = require('./shallowEqual');var shallowEqual = __REQUIRE_DEFAULT__(__TEMP__);var updateState = __TEMP__['updateState'];var debounce = __TEMP__['debounce'];\r\nvar __TEMP__ = require('./warning');var warning = __REQUIRE_DEFAULT__(__TEMP__);\r\nvar __TEMP__ = require('./wrapActionCreators.js');var wrapActionCreators = __REQUIRE_DEFAULT__(__TEMP__);\r\nvar __TEMP__ = require('./store');var getStore = __TEMP__['getStore'];\r\n\r\nconst defaultMapStateToProps = state => ({})\r\nconst defaultMapDispatchToProps = dispatch => ({ dispatch })\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = function connect(mapState = defaultMapStateToProps, mapDispatch = defaultMapDispatchToProps, preLoad = true) {\r\n  const shouldSubscribe = Boolean(mapState)\r\n  const store = getStore()\r\n  if (typeof mapDispatch !== 'function') {\r\n    mapDispatch = wrapActionCreators(mapDispatch)\r\n  }\r\n\r\n  return function wrapWithConnect(pageConfig) {\r\n    // 推迟10ms支持，便于setData的一次性数据传递，避免多次比较\r\n    const handleChange = debounce(function(options) {\r\n      if (!this.unsubscribe) {\r\n        return false\r\n      }\r\n      const state = this.$store.getState()\r\n      const mappedState = mapState(state, options)\r\n      if (!this.data || shallowEqual(this.data, mappedState)) {\r\n        return true\r\n      }\r\n      const updatedState = updateState(mappedState, this.data, '')\r\n      if (Object.keys(updatedState).length > 0) {\r\n        console.log('更新数据对象', updatedState)\r\n        this.setData(updatedState)\r\n      }\r\n    }, 1)\r\n    function setPageData(options) {\r\n      const state = store.getState()\r\n      const mappedState = mapState(state, options)\r\n      if (preLoad) {\r\n        pageConfig.data = { ...(pageConfig.data || {}), ...(mappedState || {}) }\r\n      } else {\r\n        this.setData(mappedState || {})\r\n      }\r\n    }\r\n    let _didMount\r\n    let _didUnmount\r\n    let _onLoad\r\n    let _onUnload\r\n    if (pageConfig.isComponent) {\r\n      _didMount = pageConfig.didMount\r\n      _didUnmount = pageConfig.didUnmount\r\n    } else {\r\n      _onLoad = pageConfig.onLoad\r\n      _onUnload = pageConfig.onUnload\r\n    }\r\n    if (preLoad) {\r\n      setPageData()\r\n    }\r\n\r\n    function onLoad(options) {\r\n      this.$store = store\r\n      if (!store) {\r\n        warning('请在app.js 中引入redux')\r\n      }\r\n      if (shouldSubscribe) {\r\n        this.unsubscribe = this.$store.subscribe(handleChange.bind(this, options))\r\n        if (!preLoad) {\r\n          setPageData.call(this, options)\r\n        }\r\n      }\r\n      if (typeof _onLoad === 'function') {\r\n        _onLoad.call(this, options)\r\n      }\r\n    }\r\n\r\n    function onUnLoad() {\r\n      if (typeof _onUnload === 'function') {\r\n        _onUnload.call(this)\r\n      }\r\n      if (typeof this.unsubscribe === 'function') {\r\n        this.unsubscribe()\r\n        this.unsubscribe = null\r\n      }\r\n    }\r\n\r\n    function didMount(options) {\r\n      this.$store = store\r\n      if (!store) {\r\n        warning('请在app.js 中引入redux')\r\n      }\r\n      if (shouldSubscribe) {\r\n        this.unsubscribe = this.$store.subscribe(handleChange.bind(this, options))\r\n        handleChange.call(this, options)\r\n      }\r\n      if (typeof _didMount === 'function') {\r\n        _didMount.call(this, options)\r\n      }\r\n    }\r\n\r\n    function didUnmount() {\r\n      if (typeof _didUnmount === 'function') {\r\n        _didUnmount.call(this)\r\n      }\r\n      if (typeof this.unsubscribe === 'function') {\r\n        this.unsubscribe()\r\n        this.unsubscribe = null\r\n      }\r\n    }\r\n    if (pageConfig.isComponent) {\r\n      return { ...pageConfig, ...mapDispatch(store.dispatch, store.getState()), didMount, didUnmount }\r\n    } else {\r\n      return { ...pageConfig, ...mapDispatch(store.dispatch, store.getState()), onLoad, onUnLoad }\r\n    }\r\n  }\r\n};\r\n","/**\r\n * function: shallowEqual\r\n * author  : wq\r\n * update  : 2019/5/23 11:00\r\n */\r\nconst hasOwn = Object.prototype.hasOwnProperty\r\n\r\nfunction is(x, y) {\r\n  if (x === y) {\r\n    return x !== 0 || y !== 0 || 1 / x === 1 / y\r\n  } else {\r\n    return x !== x && y !== y\r\n  }\r\n}\r\n\r\nfunction isObject(data) {\r\n  return typeof data === 'object'\r\n}\r\n\r\nfunction isEmptyData(data) {\r\n  return typeof data !== 'object' || data === null || data === undefined || typeof data === 'object' && Object.keys(data).length === 0\r\n}\r\n\r\nfunction exsitKeyNotInB(arrA, arrB) {\r\n  const obj = {}\r\n  if (arrA.length > arrB.length) {\r\n    return true\r\n  }\r\n  arrB.forEach(item => {\r\n    obj[item] = true\r\n  })\r\n  for (let i in arrA) {\r\n    if(!obj[arrA[i]]) {\r\n      return true\r\n    }\r\n  }\r\n  return false\r\n}\r\n\r\nfunction diffState(state, oldState, path) {\r\n  let diff = {}\r\n  // 两种类型不一样\r\n  if (Object.prototype.toString.call(state) !== Object.prototype.toString.call(oldState)) {\r\n    return {\r\n      [path]: state\r\n    }\r\n  }\r\n  if (isEmptyData(state)) {\r\n    if (is(state, oldState)) {\r\n      return diff\r\n    }\r\n    if (isObject(state) && isObject(oldState) && JSON.stringify(state) === JSON.stringify(oldState)) {\r\n      return diff\r\n    }\r\n    return {\r\n      [path]: state\r\n    }\r\n  }\r\n  if (isEmptyData(oldState)) {\r\n    return {\r\n      [path]: state\r\n    }\r\n  }\r\n  // 数组处理\r\n  if (Array.isArray(state)) {\r\n    // 因为没有数组删除的功能，所以只能进行整个数组重新赋值\r\n    if (oldState.length > state.length) {\r\n      return {\r\n        [path]: state\r\n      }\r\n    }\r\n    state.forEach((item, index) => {\r\n      diff = { ...diff, ...(diffState(item, oldState[index], `${path}[${index}]`)) }\r\n    })\r\n    return diff\r\n  }\r\n\r\n  if (isObject(state)) {\r\n    // 对象属性删除，setData没有对象删除的功能，所以只能重置整个对象\r\n    if (exsitKeyNotInB(Object.keys(oldState), Object.keys(state))) {\r\n      return {\r\n        [path]: state\r\n      }\r\n    }\r\n    Object.keys(state).forEach(item => {\r\n      diff = { ...diff, ...(diffState(state[item], oldState[item], `${path}.${item}`)) }\r\n    })\r\n    return diff\r\n  }\r\n}\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.debounce = function debounce(fn, delay) {\r\n  // 定时器，用来 setTimeout\r\n  let timer\r\n\r\n  // 返回一个函数，这个函数会在一个时间区间结束后的 delay 毫秒时执行 fn 函数\r\n  return function () {\r\n    // 保存函数调用时的上下文和参数，传递给 fn\r\n    const context = this\r\n    const args = arguments\r\n\r\n    // 每次这个返回的函数被调用，就清除定时器，以保证不执行 fn\r\n    clearTimeout(timer)\r\n\r\n    // 当返回的函数被最后一次调用后（也就是用户停止了某个连续的操作），\r\n    // 再过 delay 毫秒就执行 fn\r\n    timer = setTimeout(function () {\r\n      fn.apply(context, args)\r\n    }, delay)\r\n  }\r\n};\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.updateState = function updateState(state, oldState, path) {\r\n  if (typeof oldState !== 'object' || Object.keys(oldState).length === 0) {\r\n    return state\r\n  }\r\n  if (!isObject(state)) {\r\n    return {}\r\n  }\r\n  let diff = {}\r\n  Object.keys(state).forEach(item => {\r\n    diff = { ...diff, ...(diffState(state[item], oldState[item], item)) }\r\n  })\r\n  return diff\r\n};\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = function shallowEqual(objA, objB) {\r\n  if (is(objA, objB)) return true\r\n\r\n  if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {\r\n    return false\r\n  }\r\n\r\n  const keysA = Object.keys(objA)\r\n  const keysB = Object.keys(objB)\r\n\r\n  if (keysA.length !== keysB.length) return false\r\n\r\n  for (let i = 0; i < keysA.length; i++) {\r\n    if (!hasOwn.call(objB, keysA[i]) || !is(objA[keysA[i]], objB[keysA[i]])) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  return true\r\n};\r\n","/**\r\n * function: wrapActionCreators\r\n * author  : wq\r\n * update  : 2019/5/23 15:44\r\n */\r\nfunction bindActionCreator(actionCreator, dispatch) {\r\n  return function () {\r\n    return dispatch(actionCreator.apply(undefined, arguments));\r\n  };\r\n}\r\n\r\nfunction bindActionCreators(actionCreators, dispatch) {\r\n  if (typeof actionCreators === 'function') {\r\n    return bindActionCreator(actionCreators, dispatch);\r\n  }\r\n\r\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\r\n    throw new Error('bindActionCreators expected an object or a function, instead received ' + (actionCreators === null ? 'null' : typeof actionCreators) + '. ' + 'Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?');\r\n  }\r\n\r\n  var keys = Object.keys(actionCreators);\r\n  var boundActionCreators = {};\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i];\r\n    var actionCreator = actionCreators[key];\r\n    if (typeof actionCreator === 'function') {\r\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);\r\n    }\r\n  }\r\n  return boundActionCreators;\r\n}\r\n\r\nfunction wrapActionCreators(actionCreators) {\r\n  return dispatch => bindActionCreators(actionCreators, dispatch)\r\n}\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = wrapActionCreators;\r\n","/**\r\n * function: dd\r\n * author  : wq\r\n * update  : 2019/5/13 17:13\r\n */\r\nlet _app\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var setApp = exports.setApp = (app) => {\r\n  _app = app\r\n};\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var getApp = exports.getApp = (app) => {\r\n  return _app\r\n};\r\n\r\n"]}